#!/bin/csh -f
#
# BUILD-EXT - build local SX extensions
#
# Source Version: 3.0
# Software Release #: LLNL-CODE-422942
#
# include "cpyright.h"
#

@ err = 0

# generate stubs if no extensions directory exists
if (!(-d extensions)) then
   mkdir extensions
endif

pushd extensions >>& /dev/null

# write sxext.c
if (!(-f sxext.c)) then
   echo "Rebuilding extensions/sxext.c"
   cat >&! sxext.c << EOF
#include "cpyright.h"
#include "sx_int.h"
void SX_install_ext_funcs(SS_psides *si)
   {return;}
EOF
endif

# write pre-Make
if (!(-f pre-Make)) then
   echo "Rebuilding extensions/pre-Make"
   cat >&! pre-Make << EOF
TGTLib = \${LibDir}/libsx.a
UniFlags =
CcFlags  = \${CDebug} -I\${IncDir} \${MDInc} \${MDGInc}
FcFlags  =
LdFlags  = -L\${LibDir} \${LDFLAGS}
CCAnnounce = \${CCompiler} \${CDebug} \${Shared_CC_Flags} \${CFLAGS}
InstallDep = \${TGTLib}
BinDep = \${Hdrs} \${TGTLib}
Hdrs = ../sx_int.h
Objs = sxext.o
ArObjs = \${TGTLib}(sxext.o)
\${Objs} : \${Hdrs}
\${ArObjs} : \${Hdrs}
EOF
endif

# compile the extensions
pact -na 1 devlib
@ err = $status

popd >>& /dev/null

exit($err)

