#!/bin/csh -f
#
# EXT-VAR - test aexec with variables
#

@ err = 0

source $TestScrDir/env-csh

alias pe  'unsetenv astatus ; echo "" ; echo "Command: \!*" ; aexec \!* ; dbget astatus'

dbset astatus ""

#--------------------------------------------------------------------------
#--------------------------------------------------------------------------

echo "------------------------------------------------------------------------"
echo ""
echo "# simple stdout variants"

   unsetenv foo
   pe date @o vw:foo >&! ext-v1.res
   dbget foo
   cat ext-v1.res
   echo "> foo     = `printenv foo`"
   echo "> astatus = $astatus"
   if ("$astatus" != "0 0") then
      @ err = $err + 1
      echo "v1 failed"
   else
      rm -f ext-v1.res
      echo "v1 passed"
   endif

echo "------------------------------------------------------------------------"
echo ""
echo "# simple stdin variants"

   pe cat @i vr:foo >&! ext-v2.res
   cat ext-v2.res
   echo "> astatus = $astatus"
   if ("$astatus" != "0 0") then
      @ err = $err + 1
      echo "v2 failed"
   else
      rm -f ext-v2.res
      echo "v2 passed"
   endif

echo "------------------------------------------------------------------------"
echo ""
echo "# simple append variants"

   pe date @o2 va:foo >&! ext-v3.res
   dbget foo
   cat ext-v3.res
   echo "> foo     = `printenv foo`"
   echo "> astatus = $astatus"
   if ("$astatus" != "0 0") then
      @ err = $err + 1
      echo "v3 failed"
   else
      rm -f ext-v3.res
      echo "v3 passed"
   endif

echo "------------------------------------------------------------------------"
echo ""
echo "# simple bonded variants"

   pe date @b2 vw:foo >&! ext-v4.res
   dbget foo
   cat ext-v4.res
   echo "> foo     = `printenv foo`"
   echo "> astatus = $astatus"
   if ("$astatus" != "0 0") then
      @ err = $err + 1
      echo "v4 failed"
   else
      rm -f ext-v4.res
      echo "v4 passed"
   endif

echo "------------------------------------------------------------------------"
echo ""
echo "# non-simple stdout variants"

if (0) then
   unsetenv foo
   pe date @o2 @e3 vw:foo @ vw:bar >&! ext-v5.res
   dbget foo
   dbget bar
   cat ext-v5.res
   echo "> foo     = `printenv foo`"
   echo "> bar     = `printenv bar`"
   echo "> astatus = $astatus"
   if ("$astatus" != "0 0 0") then
      @ err = $err + 1
      echo "v5 failed"
   else
      rm -f ext-v5.res
      echo "v5 passed"
   endif

   unsetenv foo
   pe ls ext-* foo.h @o2 @e3 vw:foo @ vw:bar >&! ext-v6.res
   dbget foo
   dbget bar
   cat ext-v6.res
   echo "> foo     = `printenv foo`"
   echo "> bar     = `printenv bar`"
   echo "> astatus = $astatus"
   if ("$astatus" != "2 0 0") then
      @ err = $err + 1
      echo "v6 failed"
   else
      rm -f ext-v6.res
      echo "v6 passed"
   endif
endif

#--------------------------------------------------------------------------
#--------------------------------------------------------------------------

echo ""

exit($err)
