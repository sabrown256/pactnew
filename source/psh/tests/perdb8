#!/bin/csh -f
#
# PERDB8 - test authentication
#

set opt = "-l"
set db  = ./db8

setenv PERDB_PATH $db

echo "-----------------------------------"
echo "   no authentication"

rm -f db8* >& /dev/null
sign -q db8
ls-jobs

perdb $opt v1=1
ls -l $db.conn

perdb $opt v1
set v1 = ( `perdb $opt v1` )
echo "-> v1 = |$v1| ($status)"

perdb $opt quit:
sleep 1
ls -l $db*

echo "----------------"
echo "   with authentication"

rm -f db8* >& /dev/null
sign -q db8
ls-jobs

perdb $opt -a v1=2
ls -l $db.conn

set v1 = ( `perdb $opt -a v1` )
echo "-> v1 = |$v1| ($status)"

perdb $opt -a quit:
sleep 1
ls -l $db*

echo "----------------"
echo "   with authentication on server"

rm -f db8* >& /dev/null
sign -q db8
ls-jobs

perdb $opt -a v1=3
ls -l $db.conn

set v1 = ( `perdb $opt v1` )
echo "-> v1 = |$v1| ($status)"

perdb $opt quit:
sleep 1
ls -l $db*

echo "----------------"
echo "   with authentication on client"

rm -f db8* >& /dev/null
sign -q db8
ls-jobs

perdb $opt v1=4
ls -l $db.conn

#perdb $opt -a v1
set v1 = ( `perdb $opt -a v1` )
echo "-> v1 = |$v1| ($status)"

perdb $opt -a quit:
sleep 1
ls -l $db*
rm -f db8* >& /dev/null

echo "-----------------------------------"

sign -q db8

exit($status)
