#
# CFG-BASE - common code to generate the main part of a config
#          - from OS, Compiler, and bits
#
# Source Version: 3.0
# Software Release #: LLNL-CODE-422942
#
# include "cpyright.h"
#

# NOTE: use node name for config file base
# if multiple hosts have the same SYS_TYPE there will be contention
# over the file - the node name is truly host specific
   set cfg = `uname -n | tr "[A-Z]" "[a-z]" | sed 's/\..*\..*$//'`
   set los = `uname -s | tr "[A-Z]" "[a-z]"`
   set lhw = `uname -m | tr "[A-Z]" "[a-z]"`

   rm -f $Tmp
   touch $Tmp

   set lcc = $CCompiler
   switch ($lcc)
      case clang:
           set lcc = clang
           breaksw
      case gnu:
           set lcc = gcc
           breaksw
      case intel:
           set lcc = icc
           breaksw
      case path:
           set lcc = pathcc
           breaksw
      case pgi:
           set lcc = pgcc
           breaksw
      case sun:
           set lcc = suncc
           breaksw
   endsw

   echo "include spokes" >>& $Tmp
   switch ($los)
      case aix:
           set cfg = "$cfg-$Bits"
           echo "include ${Bits}-bit" >>& $Tmp
           echo "include compilers/xlc" >>& $Tmp
           breaksw
      case beos:
      case haiku:
           set cfg = "$cfg-$Bits"
           echo "include ${Bits}-bit" >>& $Tmp
           echo "include compilers/gnu" >>& $Tmp
           breaksw
      case cygwin*:
           set ladv = ""
           set ladv = ${ladv}:psh_dorun:psh_verify
           set ladv = ${ladv}:score_mpi:score_error
           set ladv = ${ladv}:pml_perf:pml_nan:pml_fpe:pml_interp
           echo "include ${Bits}-bit" >>& $Tmp
           echo "include compilers/cygwin" >>& $Tmp
           echo "setenv TEST_ADVISORY "'${TEST_ADVISORY}'"$ladv" >>& $Tmp
           unset ladv
           breaksw
      case darwin:
           set ladv = ""
           set ladv = ${ladv}:score_mpi
           set ladv = ${ladv}:pml_perf
           switch ($lcc)
              case *pgcc*:
                   echo "run std/use-compiler $lcc" >>& $Tmp
                   echo "include compilers/pgi-osx" >>& $Tmp
                   echo "setenv TEST_ADVISORY "'${TEST_ADVISORY}'"$ladv" >>& $Tmp
                   breaksw
              default:
              case *gcc*:
                   echo "run std/use-compiler $lcc" >>& $Tmp
                   echo "include compilers/gnu-osx" >>& $Tmp
                   echo "setenv TEST_ADVISORY "'${TEST_ADVISORY}'"$ladv" >>& $Tmp
                   breaksw
           endsw
           unset ladv
           breaksw
      case freebsd:
           echo "define FREEBSD" >>& $Tmp
           echo "run std/use-compiler $lcc" >>& $Tmp
           echo "include ${Bits}-bit" >>& $Tmp
           echo "include compilers/gnu-freebsd" >>& $Tmp
           echo "include features/no-sql" >>& $Tmp
           breaksw
      case hp-ux*:
           echo "include compilers/hpux" >>& $Tmp
           breaksw
      case irix*:
           echo "include ${Bits}-bit" >>& $Tmp
           echo "include cpp-rule" >>& $Tmp
           echo "include compilers/irix" >>& $Tmp
           breaksw
      case osf1:
           echo "include compilers/osf" >>& $Tmp
           breaksw
      case sunos:
           set CCSys = `$Which cc`
           set CCRoot = $CCSys:h
           set CCRoot = $CCRoot:h
           echo "setenv PACT_CC_PATH $CCRoot" >>& $Tmp
           echo "setenv PACT_FC_PATH $CCRoot" >>& $Tmp
           if (-x "$CCSys") then
              $CCSys -v |& grep gcc >& /dev/null
              if ($status == 0) then
                 echo "include compilers/gnu-sol" >>& $Tmp
              else
                 echo "include compilers/sol" >>& $Tmp
              endif
           endif
           echo 'setenv TEST_ADVISORY ${TEST_ADVISORY}:score_mpi' >>& $Tmp
           breaksw
      default:
      case linux:
           switch ($lcc)
              case clang:
                   echo "run std/use-compiler $lcc" >>& $Tmp
                   echo "include ${Bits}-bit" >>& $Tmp
                   echo "include compilers/clang" >>& $Tmp
                   unset lcc
                   breaksw
              case gnu-bgl:
                   echo "include auto-gnu-bgl" >>& $Tmp
                   breaksw
              case gnu-bgp:
                   echo "include auto-gnu-bgp" >>& $Tmp
                   breaksw
              case gnu-bgq:
                   echo "include auto-gnu-bgq" >>& $Tmp
                   breaksw
              case gnu-cxe:
                   echo "include auto-gnu-cxe" >>& $Tmp
                   breaksw
              case *icc:
                   echo "run std/use-compiler $lcc" >>& $Tmp
                   echo "include ${Bits}-bit" >>& $Tmp
                   echo "include compilers/icc" >>& $Tmp
                   breaksw
              case mingw*:
                   echo "include auto-mingw" >>& $Tmp
                   breaksw
              case *path:
              case *pathcc:
                   echo "run std/use-compiler $lcc" >>& $Tmp
                   echo "include ${Bits}-bit" >>& $Tmp
                   echo "include compilers/path" >>& $Tmp
                   breaksw
              case pgi-cxe:
                   echo "include auto-pgi-cxe" >>& $Tmp
                   breaksw
              case *pgi:
              case *pgcc:
                   echo "run std/use-compiler $lcc" >>& $Tmp
                   echo "include ${Bits}-bit" >>& $Tmp
                   echo "include compilers/pgi" >>& $Tmp
                   breaksw
	      case *sun:
	      case *suncc:
                   set ladv = ""
                   set ladv = ${ladv}:score_mpi
                   echo "run std/use-compiler $lcc" >>& $Tmp
		   echo "include compilers/sun" >>& $Tmp
                   echo "setenv TEST_ADVISORY "'${TEST_ADVISORY}'"$ladv" >>& $Tmp
                   unset ladv
                   breaksw
              case xlc-bgl:
                   echo "include auto-xlc-bgl" >>& $Tmp
                   breaksw
              case xlc-bgp:
                   echo "include auto-xlc-bgp" >>& $Tmp
                   breaksw
              case xlc-bgq:
                   echo "include auto-xlc-bgq" >>& $Tmp
                   breaksw
              default:
              case *gnu:
              case *gcc:
                   echo "run std/use-compiler $lcc" >>& $Tmp
                   echo "include ${Bits}-bit" >>& $Tmp
                   echo "include compilers/gnu" >>& $Tmp
                   unset lcc
                   breaksw
           endsw
           breaksw
   endsw
