#
# pre-Make for ULTRA
#
# Source Version: 3.0
# Software Release #: LLNL-CODE-422942
#
# include "cpyright.h"
#

LibName=ultra

TGTLib = ${LibDir}/lib${LibName}.a
TGTExe = ${BinDir}/ultra
TGTInc = ultra.h

TGTScm = applications/ultra.scm applications/consts.scm applications/func.scm  \
         applications/annotate.scm applications/compare.scm applications/trig.scm \
         applications/slice.scm applications/movie.scm \
         applications/help.scm applications/synon.scm \
         applications/toolbox.scm applications/mouse.scm applications/ultra.pui \
         applications/slib.scm

OD = DefaultG

#
# Compiler/Loader Options
#
CcFlags = -I${IncDir} ${MDInc} ${MDGInc}
LdFlags = -L${LibDir} ${LDFLAGS} 

#
# Files to Save for Backup (pact save)
#
SaveFiles = *.c *.h .scm

#
# Files to remove in directory clean (pact clean)
#
CleanFiles = *~ core

#
# Things upon which install depends (pact install)
#
DepLib = ${LibDir}/libsx.a \
         ${LibDir}/libscheme.a \
         ${LibDir}/libpanacea.a \
         ${LibDir}/libpgs.a \
	 ${LibDir}/libppc.a \
         ${LibDir}/libpdb.a \
         ${LibDir}/libpml.a \
	 ${LibDir}/libscore.a

InstallDep = ${TGTLib} ${TGTExe}
BinDep = ${Hdrs} ${TGTLib} ultra.c ${DepLib}
BinObj = ${LdFlags} ultra.c

#
# Generated code rules
#

# headers

hdrf = 

IncAction = 


#
# Required Libraries
#
Libs = ${LULTRA} ${LSX} ${LPANACEA} ${LPGS} ${MDGLib} ${LSCHEME} ${LPPC} ${LPDB} ${LPML} ${LSCORE} ${MDLib} ${MDE_Lib} ${MDLibCfg}

targets :
	@echo "Targets for ULTRA"
	@echo "   install   : install ULTRA headers and utilities in dev/sys_id"
	@echo "   link      : link ULTRA utilities for public use"
	@echo "   sharedlib : build and install ULTRA shared libs in dev/sys_id"
	@echo "   test      : run the ULTRA test suite"

#
# Headers Files
#
Hdrs = ultra.h

#
# Object Files
#
Objs = ulfunc.o ulauxf.o ulhand.o ulcntl.o

ArObjs = ${TGTLib}(ulfunc.o) ${TGTLib}(ulauxf.o) \
	 ${TGTLib}(ulhand.o) ${TGTLib}(ulcntl.o)

${Objs} : ${Hdrs}
${LibDep} : ${Hdrs}

#
# make the executable
#
${TGTExe} : ${BinDep}
	@(echo "${CCAnnounce} ultra.c -o ${TGTExe}" ; \
	  ${CLD} ${LdFlags} ultra.c -o ${TGTExe} ${Libs})

#
# link 
#
link: ${InstallDep}
	sinstall ultra.ini.user ${ScmDir}/ultra.ini
	pact scminstall

#
# install 
#
install:
	pact link

#
# sharedlib
#
sharedlib:
	pact shared

#
# inform
#
inform :
	@rm -f required.objs
	@echo ${Objs} > required.objs

#
# Run the ULTRA test suite
#
test :
	@./ultest
