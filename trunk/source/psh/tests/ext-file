#!/bin/csh -f
#
# EXT-FILE - test aexec with files
#

unalias *

@ err = 0

source $TestScrDir/env-csh

alias pe  'unsetenv astatus ; echo "" ; echo "Command: \!*" ; aexec \!* ; dbget astatus'

rm -f ext-*.res.raw >& /dev/null

#--------------------------------------------------------------------------
#--------------------------------------------------------------------------

echo "------------------------------------------------------------------------"
echo ""
echo "# simple stdout variants"

   rm -rf f1
   pe /bin/echo f1 @o fw:f1.dat >&! ext-f1.res
   cat ext-f1.res
   echo "> f1.dat  = `cat f1.dat`"
   echo "> astatus = $astatus"
   if ("$astatus" != "0 0") then
      @ err = $err + 1
      echo "f1 failed"
   else
      rm -f ext-f1.res
      echo "f1 passed"
   endif

echo "------------------------------------------------------------------------"
echo ""
echo "# simple stdin variants"

   pe cat @i fr:f1.dat >&! ext-f2.res
   cat ext-f2.res
   echo "> astatus = $astatus"
   if ("$astatus" != "0 0") then
      @ err = $err + 1
      echo "f2 failed"
   else
      rm -f ext-f2.res
      echo "f2 passed"
   endif

echo "------------------------------------------------------------------------"
echo ""
echo "# simple append variants"

   pe /bin/echo f3 @o2 fa:f1.dat >&! ext-f3.res
   cat ext-f3.res
   echo "> f1.dat  = `cat f1.dat`"
   echo "> astatus = $astatus"
   if ("$astatus" != "0 0") then
      @ err = $err + 1
      echo "f3 failed"
   else
      rm -f ext-f3.res
      echo "f3 passed"
   endif

echo "------------------------------------------------------------------------"
echo ""
echo "# simple bonded variants"

   pe /bin/echo f4 @b2 fw:f4.dat >&! ext-f4.res
   cat ext-f4.res
   echo "> f4.dat  = `cat f4.dat`"
   echo "> astatus = $astatus"
   if ("$astatus" != "0 0") then
      @ err = $err + 1
      echo "f4 failed"
   else
      rm -f ext-f4.res
      echo "f4 passed"
   endif

echo "------------------------------------------------------------------------"
echo ""
echo "# non-simple stdout variants"

   rm -rf f5out
   pe /bin/echo f5 @o2 @e3 fw:f5out @ fw:f5err >&! ext-f5.res
   cat ext-f5.res
   echo "> f5out  = `cat f5out`"
   echo "> f5err  = `cat f5err`"
   echo "> astatus = $astatus"
   if ("$astatus" != "0 0 0") then
      @ err = $err + 1
      echo "f5 failed"
   else
      rm -f ext-f5.res
      echo "f5 passed"
   endif

   rm -rf f6out
   pe ls ext-* foo.h @o2 @e3 fw:f6out @ fw:f6err >&! ext-f6.res.raw
   sort ext-f6.res.raw >&! ext-f6.res
   cat ext-f6.res
   echo "> f6out  = `cat f6out`"
   echo "> f6err  = `cat f6err`"
   echo "> astatus = $astatus"
   if ("$astatus" != "2 0 0") then
      @ err = $err + 1
      echo "f6 failed"
   else
      rm -f ext-f6.res
      echo "f6 passed"
   endif

#--------------------------------------------------------------------------
#--------------------------------------------------------------------------

echo ""

exit($err)
