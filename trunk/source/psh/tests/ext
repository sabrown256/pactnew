#!/bin/csh -f
#
# EXT - test aexec
#

source ../../tests/common

set msg = "AEXEC Test ....................."

set AEXEC = aexec
set PERDB = perdb

set lst = ( job pipe file var )

while ($#argv > 0)
   switch ($1)
      case -h:
           echo ""
           echo "Usage: aexec [-h]"
           echo "  h  this help message"
           echo ""
           exit(1);
      default:
           breaksw
   endsw
   shift
end

   NoteD $Log ""
   NoteD $Log "                    $msg"

   @ nerr = 0

   set tf = `timer -r`

   flog $Log setenv PERDB_PATH $cwd/ext
   flog $Log $PERDB -l -c -s

   flog $Log rm -f run.* s*
   flog $Log cp $SrcDir/tests/ext-* .

   Note $Log "Using $AEXEC"
   Note $Log "Path = $PATH"

   flog $Log pwd
   flog $Log ls -l ext-*

   foreach t ($lst)
      Separator $Log

      set f = ( `fill-string -n 28 $t` )
      NoteD $Log -n "                        $f"
      Note $Log ""

      set exe = $t
      set opt = ""
      set rpf = ""

      set lt = `timer -r`

      flog $Log ./ext-$t
      set xstatus = $status

      set lt = `timer -b $lt`

      set rpf = ( $rpf ext-$t )

      $TEST_CHECK part -a aexec_${t} -e $xstatus -dt $lt -x $exe -l -rpf "$rpf" none
      @ nerr = $nerr + $status
   end

   flog $Log $PERDB -l quit:

   set tf = `timer -b $tf`

$TEST_CHECK part -a aexec -e $nerr -dt $tf -rpf "$rpf" "$msg"

exit($status)

