#!/bin/csh -f
#
# REGX - test pattern matching
#
# Source Version: 3.0
# Software Release #: LLNL-CODE-422942
#
# include "cpyright.h"
#

set Package = psh
if (-f test-env) then
   source test-env
   pushd $TestDir >& /dev/null
else
   source ../../../scripts/test-env
endif

while ($#argv > 0)
   switch ($1)
      case -h:
           echo ""
           echo "Usage: pco [-h]"
           echo "  h  this help message"
           echo ""
           exit(1);
      default:
           breaksw
   endsw
   shift
end

@ Err = 0


NoteD $Log ""
NoteD $Log -n "                    REGX Test ...................... "
Note $Log ""

set BTime = `$TIMER -r`

set ref  = ../../tests/ref/mats
set tdir = $cwd

flog $Log pushd ../..
flog $Log ./ccw -I. tests/mats.c -o $tdir/mats
flog $Log popd

flog $Log (./mats >&! mats.res)

if (-f $ref) then
   flog $Log diff mats.res $ref
   set xstatus = $status
else
   flog $Log cp mats.res $ref
   set xstatus = $status
endif

flog $Log rm mats

set ETime = `$TIMER -b $BTime`
if ($xstatus == 0) then
   NoteD $Log "PASSED ($ETime)"
else
   NoteD $Log "FAILED ($xstatus/$ETime)"
   set ERROR = "TRUE"
endif

#--------------------------------------------------------------------------
#--------------------------------------------------------------------------

$TEST_CHECK -a regx -e $Err part

exit($status)
