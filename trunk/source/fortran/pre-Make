#
# pre-Makefile for PFTN
#
# Files and Directories
#
# Source Version: 3.0
# Software Release #: LLNL-CODE-422942
#
# include "cpyright.h"
#

LibName=fpact

TGTLib = ${LibDir}/lib${LibName}.a
TGTInc = none

OD = DefaultO

#
# Compiler/Loader Options
#
CcFlags = ${ODC} -I. -I${PACTSrcDir} -I${IncDir} ${MDInc}
FcFlags = ${ODF}
LdFlags = -L${LibDir} ${LDFLAGS}

CCAnnounce = ${CCompiler} ${ODC} ${CShared} ${CFLAGS}

#
# Files to Save for Backup (make save)
#
SaveFiles = *.f

#
# Files to remove in directory clean (pact clean)
#
CleanFiles = ${gmo} *~ core

#
# Files to remove in directory clean (pact clean)
#
RemoveFiles = ${gmo} *~ core

#
# Things upon which install depends (pact install)
#
InstallDep = ${TGTLib}
BinDep =
BinObj =

#
# Required Libraries
#

targets :
	@echo "Targets for PFTN"
	@echo "   install      : install PFTN headers and utilities in dev/arch"
	@echo "   link         : link PFTN utilities for public use"
	@echo "   test         : run the PFTN test suite"

#
# Headers Files
#
Hdrs = 

gfs = gf-score.c gf-pml.c gf-pdb.c   \
      gf-ppc.c gf-pgs.c gf-panacea.c \
      gf-scheme.c

gms = gm-score.f gm-pml.f gm-pdb.f   \
      gm-ppc.f gm-pgs.f gm-panacea.f \
      gm-scheme.f

#
# Object Files
#

gfo = gf-score.o gf-pml.o gf-pdb.o   \
      gf-ppc.o gf-pgs.o gf-panacea.o \
      gf-scheme.o

gmo = gm-score.o gm-pml.o gm-pdb.o   \
      gm-ppc.o gm-pgs.o gm-panacea.o \
      gm-scheme.o

Objs = ${gmo} ${gfo} flibc.o

gfa = ${TGTLib}(gf-score.o) ${TGTLib}(gf-pml.o) ${TGTLib}(gf-pdb.o)   \
      ${TGTLib}(gf-ppc.o) ${TGTLib}(gf-pgs.o) ${TGTLib}(gf-panacea.o) \
      ${TGTLib}(gf-scheme.o)

gma = ${TGTLib}(gm-score.o) ${TGTLib}(gm-pml.o) ${TGTLib}(gm-pdb.o)   \
      ${TGTLib}(gm-ppc.o) ${TGTLib}(gm-pgs.o) ${TGTLib}(gm-panacea.o) \
      ${TGTLib}(gm-scheme.o)

ArObjs = ${gma} ${gfa} ${TGTLib}(flibc.o)

${ArObjs}  : ${Hdrs}
${Objs}  : ${Hdrs}
${LibDep} : ${Hdrs}

modules : ${gmo} ${gfo}
	@touch dummy.mod
	cp *.mod ${IncDir}
	@rm -f ${IncDir}/dummy.mod

${PACTTmpDir}/gm-${LibName}.f : flibc.f
	@../scripts/bproto

genmod : ${PACTTmpDir}/gm-${LibName}.f

IncAction = @pact genmod
LibAction = @(cd ${PACTTmpDir} ; pact -f ../../pre-Make modules)

#
# link 
#
link: ${InstallDep}

#
# install
#
install:
	pact link

#
# sharedlib
#
sharedlib:
	pact shared

#
# Run the PFTN test suite
#
test :
	@./fttest

